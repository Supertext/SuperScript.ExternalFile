<h2>External File Storage</h2>

<p>
  SuperScript.ExternalFile offers options for the location in which the file contents are stored.
</p>

<ul>
	<li><a href="#!/store/iso-storage">Isolated storage</a></li>
	<li><a href="#!/store/file-store">File storage</a></li>
</ul>

<p>
	These storage options are implementations of <abbr title="SuperScript.ExternalFile.Storage.IStore"><code>IStore</code></abbr>.
</p>

<pre class="brush: c#">
  interface IStore
  {
    void AddOrUpdate(SuperScript.ExternalFile.Storage.IStorable storable);
    void Delete(string key);
    void Empty();
    IStorable Get(string key);
    IEnumerable&lt;SuperScript.ExternalFile.Storage.IStorable&gt; GetAll();
    void Init();
    void Remove();
    string StoreName { get; set; }
  }
</pre>

<p>
  All configured storage providers must derive from <abbr title="SuperScript.ExternalFile.Storage.IStore"><code>IStore</code></abbr>.
</p>

<table class="table table-bordered">
	<thead>
		<tr>
			<th>Name</th>
			<th>Type</th>
			<th>Description</th>
		</tr>
	</thead>
	<tr>
		<td>AddOrUpdate</td>
		<td>void</td>
		<td>
			<p>
			  Adds the specified instance of <abbr title="SuperScript.ExternalFile.Storage.IStorable"><code>IStorable</code></abbr> to 
			  the store using the specified key. If an item exists with the specified 
			  <abbr title="SuperScript.ExternalFile.Storage.IStorable.Key"><code>Key</code></abbr> then it will be updated.
			</p>
		</td>
	</tr>
	<tr>
		<td>Delete</td>
		<td>void</td>
		<td>
			<p>
			  Deletes the specified instance of <abbr title="SuperScript.ExternalFile.Storage.IStorable"><code>IStorable</code></abbr>.
			</p>
		</td>
	</tr>
	<tr>
		<td>Empty</td>
		<td>void</td>
		<td>
			<p>
			  Removes all directories and instances of <abbr title="SuperScript.ExternalFile.Storage.IStorable"><code>IStorable</code></abbr> from the store.
			</p>
		</td>
	</tr>
	<tr>
		<td>Get</td>
		<td><abbr title="SuperScript.ExternalFile.Storage.IStorable"><code>IStorable</code></abbr></td>
		<td>
			<p>
			  Gets the instance of <abbr title="SuperScript.ExternalFile.Storage.IStorable"><code>IStorable</code></abbr> with the specified key.
			</p>
			<p>
			  Returns <code>null</code> if no matching keys were found.
			</p>
		</td>
	</tr>
	<tr>
		<td>GetAll</td>
		<td>IEnumerable&lt;<abbr title="SuperScript.ExternalFile.Storage.IStorable"><code>IStorable</code></abbr>&gt;</td>
		<td>
			<p>
			  Returns a snapshot of all <abbr title="SuperScript.ExternalFile.Storage.IStorable"><code>IStorable</code></abbr> instances 
			  in the store.
			</p>
		</td>
	</tr>
	<tr>
		<td>Init</td>
		<td>void</td>
		<td>
			<p>
			  Performs any initilisation that the store requires before items may be stored and retrieved.
			</p>
		</td>
	</tr>
	<tr>
		<td>Remove</td>
		<td>void</td>
		<td>
			<p>
			  Removes all traces of the store.
			</p>
		</td>
	</tr>
	<tr>
	  <td>StoreName</td>
	  <td>string</td>
	  <td>
	    <p>
	      Gets or sets the name of the top-level directory inside the storage provider, should it be required.
	    </p>
	  </td>
	</tr>
</table>

<p>
  Custom implementations of <abbr title="SuperScript.ExternalFile.Storage.IStore"><code>IStore</code></abbr> are pluggable, though
  SuperScript offers two storage methods out of the box.
</p>

<h3 id="iso-storage">Isolated Storage</h3>

<p>
  The default, out of the box storage option provided by SuperScript.ExternalFile is isolated storage.
</p>

<p>
  This is implemented by <abbr title="SuperScript.ExternalFile.Storage.IsoStore"><code>IsoStore</code></abbr>.
</p>

<p>
  The <abbr title="SuperScript.ExternalFile.Storage.IsoStore"><code>IsoStore</code></abbr> provider offers a secure storage 
  location which keeps its contents visible only to the permitted application. This is particularly useful on a shared server.
</p>

<h4 id="conf-iso-storage">Configuring Isolated Storage</h4>

<p>
  Although <abbr title="SuperScript.ExternalFile.Storage.IsoStore"><code>IsoStore</code></abbr> is pre-configured as the default 
  storage provider, the following example shows how this may be explicitly configured.
</p>

<pre class="brush: xml; highlight: 9">
  &lt;configuration&gt;
    &lt;configSections&gt;
    &lt;section name="superScript" type="SuperScript.Configuration.SuperScriptConfig, SuperScript.Common" /&gt;
    &lt;section name="superScript.ExternalFile" type="SuperScript.ExternalFile.Configuration.ExternalFileConfig, SuperScript.ExternalFile" /&gt;
    &lt;/configSections&gt;
  &lt;/configuration&gt;
  &hellip;
  &lt;superScript.ExternalFile&gt;
    &lt;storage type="SuperScript.ExternalFile.Storage.IsoStore, SuperScript.ExternalFile" /&gt;
  &lt;/superScript.ExternalFile&gt;
</pre>

<p>
	To configure <abbr title="SuperScript.ExternalFile.Storage.IsoStore"><code>IsoStore</code></abbr> in code requires an
	extra step: the store must be explicitly initialised.
</p>

<pre class="brush: c#; highlight: 2">
	IStore storeIso = new IsoStore();
	storeIso.Init();
	SuperScript.ExternalFile.Configuration.Settings.Instance.StoreProvider = storeIso;
</pre>

<p>
	An ideal location for the above code would be in <code>global.asax</code> or a method called from <code>global.asax</code>.
</p>

<h3 id="file-storage">File Storage</h3>

<p>
  The <abbr title="SuperScript.ExternalFile.Storage.FileStore"><code>FileStore</code></abbr> provider uses the host file system
  for storing serialised instances of <abbr title="SuperScript.ExternalFile.Storage.IStorable"><code>IStorable</code></abbr>.
</p>

<p>
  <abbr title="SuperScript.ExternalFile.Storage.FileStore"><code>FileStore</code></abbr> offers the advantage of being 
  navigable and easily viewed. However, file-based storage may not offer the same security on shared servers as 
  does <abbr title="SuperScript.ExternalFile.Storage.IsoStore"><code>IsoStore</code></abbr>.
</p>

<h4 id="conf-file-storage">Configuring File Storage</h4>

<p>
  The following example shows how <abbr title="SuperScript.ExternalFile.Storage.FileStore"><code>FileStore</code></abbr> may 
  be configured.
</p>

<p>
  <strong>Important: </strong> <abbr title="SuperScript.ExternalFile.Storage.FileStore"><code>FileStore</code></abbr> will store
  the serialised instances of <abbr title="SuperScript.ExternalFile.Storage.IStorable"><code>IStorable</code></abbr> in a directory 
  (whose name corresponds to the <abbr title="SuperScript.ExternalFile.Storage.IStore.StoreName"><code>StoreName</code></abbr> property) under 
  the web application's working directory.
</p>

<p>
  The following example also demonstrates how to set the name of the store when declared in the config file.
</p>

<pre class="brush: xml; highlight: [8, 11]">
  &lt;configuration&gt;
    &lt;configSections&gt;
    &lt;section name="superScript" type="SuperScript.Configuration.SuperScriptConfig, SuperScript.Common" /&gt;
    &lt;section name="superScript.ExternalFile" type="SuperScript.ExternalFile.Configuration.ExternalFileConfig, SuperScript.ExternalFile" /&gt;
    &lt;/configSections&gt;
  &lt;/configuration&gt;
  &hellip;
  &lt;superScript.ExternalFile&gt;
    &lt;storage type="SuperScript.ExternalFile.Storage.FileStore, SuperScript.ExternalFile"&gt;
      &lt;properties&gt;
        &lt;property name="StoreName" value="external-files" type="System.String, mscorlib" />
      &lt;/properties&gt;
    &lt;/storage&gt;
  &lt;/superScript.ExternalFile&gt;
</pre>

<p>
	As with the <abbr title="SuperScript.ExternalFile.Storage.IsoStore"><code>IsoStore</code></abbr>, configuring 
	<abbr title="SuperScript.ExternalFile.Storage.FileStore"><code>FileStore</code></abbr> in code requires that the 
	store must be explicitly initialised.
</p>

<pre class="brush: c#; highlight: 2">
	IStore storeFile = new FileStore();
	storeFile.Init();
	SuperScript.ExternalFile.Configuration.Settings.Instance.StoreProvider = storeFile;
</pre>

<h3 id="custom-implementations">Custom Implementations</h3>

<p>
	Custom implementations of <abbr title="SuperScript.ExternalFile.Storage.IStore"><code>IStore</code></abbr> are encouraged. So
	long as the custom implentation derives from <abbr title="SuperScript.ExternalFile.Storage.IStore"><code>IStore</code></abbr> then
	it may configured in exactly the same way as <abbr title="SuperScript.ExternalFile.Storage.IsoStore"><code>IsoStore</code></abbr>
	and <abbr title="SuperScript.ExternalFile.Storage.FileStore"><code>FileStore</code></abbr>.
</p>

<h2>External File Storage</h2>

<p>
  SuperScript.ExternalFile offers options for the location in which the file contents are stored.
</p>

<ul>
	<li><a href="#!/storage.iso-storage">Isolated storage</a></li>
	<li><a href="#!/storage.file-storage">File storage</a></li>
</ul>

<p>
	These storage options are implementations of <abbr title="SuperScript.ExternalFile.Storage.IStore"><code>IStore</code></abbr>.
</p>

<pre class="brush: c#">
  interface IStore
  {
    void AddOrUpdate(SuperScript.ExternalFile.Storage.IStorable storable);
    void Delete(string key);
    void Empty();
    IStorable Get(string key);
    IEnumerable&lt;SuperScript.ExternalFile.Storage.IStorable&gt; GetAll();
    void Init();
    void Remove();
    void Scavenge(TimeSpan removeThreshold);
    string StoreName { get; set; }
  }
</pre>

<p>
  All configured storage providers must derive from <abbr title="SuperScript.ExternalFile.Storage.IStore"><code>IStore</code></abbr>.
</p>

<table class="table table-bordered">
	<thead>
		<tr>
			<th>Name</th>
			<th>Type</th>
			<th>Description</th>
		</tr>
	</thead>
	<tr>
		<td>AddOrUpdate</td>
		<td>void</td>
		<td>
			<p>
			  Adds the specified instance of <abbr title="SuperScript.ExternalFile.Storage.IStorable"><code>IStorable</code></abbr> to 
			  the store using the specified key. If an item exists with the specified 
			  <abbr title="SuperScript.ExternalFile.Storage.IStorable.Key"><code>Key</code></abbr> then it will be updated.
			</p>
		</td>
	</tr>
	<tr>
		<td>Delete</td>
		<td>void</td>
		<td>
			<p>
			  Deletes the specified instance of <abbr title="SuperScript.ExternalFile.Storage.IStorable"><code>IStorable</code></abbr>.
			</p>
		</td>
	</tr>
	<tr>
		<td>Empty</td>
		<td>void</td>
		<td>
			<p>
			  Removes all directories and instances of <abbr title="SuperScript.ExternalFile.Storage.IStorable"><code>IStorable</code></abbr> from the store.
			</p>
		</td>
	</tr>
	<tr>
		<td>Get</td>
		<td><abbr title="SuperScript.ExternalFile.Storage.IStorable"><code>IStorable</code></abbr></td>
		<td>
			<p>
			  Gets the instance of <abbr title="SuperScript.ExternalFile.Storage.IStorable"><code>IStorable</code></abbr> with the specified key.
			</p>
			<p>
			  Returns <code>null</code> if no matching keys were found.
			</p>
		</td>
	</tr>
	<tr>
		<td>GetAll</td>
		<td>IEnumerable&lt;<abbr title="SuperScript.ExternalFile.Storage.IStorable"><code>IStorable</code></abbr>&gt;</td>
		<td>
			<p>
			  Returns a snapshot of all <abbr title="SuperScript.ExternalFile.Storage.IStorable"><code>IStorable</code></abbr> instances 
			  in the store.
			</p>
		</td>
	</tr>
	<tr>
		<td>Init</td>
		<td>void</td>
		<td>
			<p>
			  Performs any initilisation that the store requires before items may be stored and retrieved.
			</p>
		</td>
	</tr>
	<tr>
		<td>Remove</td>
		<td>void</td>
		<td>
			<p>
			  Removes all traces of the store.
			</p>
		</td>
	</tr>
	<tr>
		<td>Scavenge</td>
		<td>void</td>
		<td>
			<p>
				Removes instances of <abbr title="SuperScript.ExternalFile.Storage.IStorable"><code>IStorable</code></abbr> which are older than the specified <code>TimeSpan</code>.
			</p>
		</td>
	</tr>
	<tr>
	  <td>StoreName</td>
	  <td>string</td>
	  <td>
	    <p>
	      Gets or sets the name of the top-level directory inside the storage provider, should it be required.
	    </p>
	  </td>
	</tr>
</table>

<h3 id="config">Configuration</h3>

<p>
	Configuring each of the implementations of <abbr title="SuperScript.ExternalFile.Storage.IStore"><code>IStore</code></abbr> is
	covered in the documentation for each implementation. However, there is one common feature which will be covered here: <em>scavenging</em>.
</p>

<h4>Scavenging</h4>

<p>
	<em>Scavenging</em> is the process of clearing up outdated instances of <abbr title="SuperScript.ExternalFile.Storage.IStorable"><code>IStorable</code></abbr>. 
	This is carried out in a background process, and SuperScript.ExternalFile allows two properties to be configured:
</p>

<table class="table table-bordered">
	<thead>
		<tr>
			<th>Name</th>
			<th>Type</th>
			<th>Description</th>
		</tr>
	</thead>
	<tr>
		<td>ScavengePeriod</td>
		<td>TimeSpan</td>
		<td>
			<p>
				Gets or sets how often the scavenger should clear out old instances of <abbr title="SuperScript.ExternalFile.Storage.IStorable"><code>IStorable</code></abbr>.
			</p>
			<p>
				<strong>Optional</strong>. Default value is 1 hour.
			</p>
		</td>
	</tr>
	<tr>
		<td>ScavengeItemsOlderThan</td>
		<td>TimeSpan</td>
		<td>
			<p>
				Gets or sets how old an <abbr title="SuperScript.ExternalFile.Storage.IStorable"><code>IStorable</code></abbr> should be in order to be scavenged.
			</p>
			<p>
				<strong>Optional</strong>. Default value is 1 hour.
			</p>
		</td>
	</tr>
</table>

<p>
	The above properties may be declared in the configuration file:
</p>

<pre class="brush: xml">
	&lt;configuration&gt;
		&lt;configSections&gt;
			&lt;section name="superScript" type="SuperScript.Configuration.SuperScriptConfig, SuperScript.Common" /&gt;
			&lt;section name="superScript.ExternalFile" type="SuperScript.ExternalFile.Configuration.ExternalFileConfig, SuperScript.ExternalFile" /&gt;
		&lt;/configSections&gt;
		&hellip;
		&lt;superScript.ExternalFile&gt;
			&lt;scavenger scavengeItemsOlderThan="00:00:10" scavengePeriod="00:00:10" /&gt;
		&lt;/superScript.ExternalFile&gt;
	&lt;/configuration&gt;
</pre>

<p>
	Internally, SuperScript.ExternalFile calls <code>TimeSpan.Parse</code> to parse the declared value in the configuration file.
	More details about this method can be read <a href="https://msdn.microsoft.com/en-us/library/se73z7b9%28v=vs.110%29.aspx" target="_blank">here</a>.
</p>

<p>
	Alternatively, the above properties may also be declared programmatically:
</p>

<pre class="brush: c#">	
	SuperScript.ExternalFile.Configuration.Settings.Instance.ScavengePeriod = new TimeSpan(0, 0, 10);
	
	SuperScript.ExternalFile.Configuration.Settings.Instance.ScavengeItemsOlderThan = new TimeSpan(0, 0, 10);
</pre>

<p>
	Both of the above examples set the <abbr title="SuperScript.ExternalFile.Configuration.Settings.Instance.ScavengePeriod"><code>ScavengePeriod</code></abbr> and
	<abbr title="SuperScript.ExternalFile.Configuration.Settings.Instance.ScavengeItemsOlderThan"><code>ScavengeItemsOlderThan</code></abbr> properties
	to a <code>TimeSpan</code> indicating 10 minutes.
</p>

<p>
	Once again, the default value is 1 hour.
</p>

<h3 id="custom-implementations">Custom Implementations</h3>

<p>
	Custom implementations of <abbr title="SuperScript.ExternalFile.Storage.IStore"><code>IStore</code></abbr> are encouraged. So
	long as the custom implentation derives from <abbr title="SuperScript.ExternalFile.Storage.IStore"><code>IStore</code></abbr> then
	it may configured in exactly the same way as <abbr title="SuperScript.ExternalFile.Storage.IsoStore"><code>IsoStore</code></abbr>
	and <abbr title="SuperScript.ExternalFile.Storage.FileStore"><code>FileStore</code></abbr>.
</p>

<p>
	If a database-based storage system is preferred (perhaps in a multi-server environment) then options are available. Please
	take a look through the <a href="http://supertext.github.io/SuperScript.Common/#!/current-projects">current projects</a> for 
	those projects whose name has the format <em>SuperScript.ExternalFile...</em>.
</p>
